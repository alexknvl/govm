<!DOCTYPE html>
<html>

<head>
    <title>GOVM</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- 引入 Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- HTML5 Shiv 和 Respond.js 用于让 IE8 支持 HTML5元素和媒体查询 -->
    <!-- 注意： 如果通过 file://  引入 Respond.js 文件，则该文件无法起效果 -->
    <!--[if lt IE 9]>
         <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
         <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
      <![endif]-->
</head>

<body>
    <div class="container">
        <div id="navbar"></div>
        <div class="col-md-12 column">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">Info</h3>
                </div>
                <div class="panel-body">
                    <div class="input-group">
                        <span class="input-group-addon">Chain:</span>
                        <span class="form-control" id="chain"></span>
                    </div>
                    <br>
                    <div class="input-group">
                        <span class="input-group-addon">Wallet Address:</span>
                        <span class="form-control" id="address"></span>
                    </div>
                    <br>
                    <div class="input-group">
                        <span class="input-group-addon">Balance:</span>
                        <span class="form-control" id="balance"></span>
                    </div>
                </div>
            </div>
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">New Wallet</h3>
                    <p>it will replace the old wallet of configure</p>
                </div>
                <div class="panel-body">
                    <form class="bs-example bs-example-form" role="form">
                        <div class="input-group">
                            <span class="input-group-addon">wallet file:</span>
                            <input class="form-control" name="wallet_file" value="wallet.key"></span>
                        </div>
                        <br>
                        <div class="input-group">
                            <span class="input-group-addon">password:</span>
                            <input class="form-control" type="password" name="password"></span>
                        </div>
                        <br>
                        <button type="button" class="btn btn-success pull-right" id="submit">New</button>
                    </form>
                </div>
                <div>
                    <h3 id="result">
                    </h3>
                </div>
            </div>
        </div>
    </div>

    <!-- jQuery (Bootstrap 的 JavaScript 插件需要引入 jQuery) -->
    <script src="js/jquery-3.3.1.min.js"></script>
    <!-- 包括所有已编译的插件 -->
    <script src="js/bootstrap.min.js"></script>
    <script type="text/javascript" src="/js/jquery.serializejson.js"></script>
    <script src="js/load.js"></script>

    <script type="text/javascript">

        $.get("/api/v1/1/account", function (data, status) {
            if (status != "success") {
                alert("Data: " + data + "\nStatus: " + status);
            } else {
                $("#chain").html("<b>" + data.chain + "</b>");
                $("#address").html("<b>" + data.address + "</b>");
                $("#balance").html("<b>" + fmoney(data.cost) + "</b>");
                // $("#balance").html("<b>" + data.cost/1000000000.0 + "</b>");
            }
        });

        function fmoney(s) {
            console.log("money:"+s)
            s = parseFloat((s + "").replace(/[^\d\.-]/g, "")).toFixed(10) + "";
            var l = s.split(".")[0].split("").reverse();
            var t = "";
            for (i = 0; i < l.length; i++) {
                t += l[i] + ((i + 1) % 3 == 0 && (i + 1) != l.length ? "," : "");
            }
            return t.split("").reverse().join("");
        }
        $('#submit').on('click', function () {
            var data = $('form').serializeJSON();
            data = JSON.stringify(data)
            $.ajax({
                type: "POST",
                url: "/api/v1/wallet",
                data: data,
                dataType: "json",
                contentType: "application/json",
                success: function (data) {
                    $("#result").html("<span class=\"label label-success\">wallet address:" + data.wallet_addr + "</span>");
                    $("#wallet_file").html("");
                    $("#password").html("");
                    window.location.reload()
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    $("#result").html("<span class=\"label label-danger\">error code:" + XMLHttpRequest.status +
                        ". msg: " + XMLHttpRequest.responseText + "</span>");
                }
            });
        });
    </script>

</body>

</html>